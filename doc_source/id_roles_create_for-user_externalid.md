# How to use an external ID when granting access to your AWS resources to a third party<a name="id_roles_create_for-user_externalid"></a>

At times, you need to give a third party access to your AWS resources \(delegate access\)\. One important aspect of this scenario is the *External ID*, optional information that you can use in an IAM role trust policy to designate who can assume the role\.

**Important**  
AWS does not treat the external ID as a secret\. After you create a secret like an access key pair or a password in AWS, you cannot view them again\. The external ID for a role can be seen by anyone with permission to view the role\. 

In a multi\-tenant environment where you support multiple customers with different AWS accounts, we recommend using one external ID per AWS account\. This ID should be a random string generated by the third party\.

To require that the third party provides an external ID when assuming a role, update the role's trust policy with the external ID of your choice\. 

To provide an external ID when you assume a role, use the AWS CLI or AWS API to assume that role\. For more information, see the STS [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) API operation, or the STS [assume\-role](https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role.html) CLI operation\.

For example, let's say that you decide to hire a third\-party company called Example Corp to monitor your AWS account and help optimize costs\. In order to track your daily spending, Example Corp needs to access your AWS resources\. Example Corp also monitors many other AWS accounts for other customers\.

Do not give Example Corp access to an IAM user and its long\-term credentials in your AWS account\. Instead, use an IAM role and its temporary security credentials\. An IAM role provides a mechanism to allow a third party to access your AWS resources without needing to share long\-term credentials \(such as an IAM user access key\)\.

You can use an IAM role to establish a trusted relationship between your AWS account and the Example Corp account\. After this relationship is established, a member of the Example Corp account can call the AWS Security Token Service [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html) API to obtain temporary security credentials\. The Example Corp members can then use the credentials to access AWS resources in your account\. 

**Note**  
For more information about the AssumeRole and other AWS API operations that you can call to obtain temporary security credentials, see [Requesting temporary security credentials](id_credentials_temp_request.md)\.

Here's a more detailed breakdown of this scenario:

1. You hire Example Corp, so they create a unique customer identifier for you\. They provide you with this unique customer ID and their AWS account number\. You need this information to create an IAM role in the next step\. 
**Note**  
Example Corp can use any string value they want for the ExternalId, as long as it is unique for each customer\. It can be a customer account number or even a random string of characters, as long as no two customers have the same value\. It is not intended to be a 'secret'\. Example Corp must provide the ExternalId value to each customer\. What is crucial is that it must be generated by Example Corp and ***not*** their customers to ensure each external ID is unique\.

1. You sign in to AWS and create an IAM role that gives Example Corp access to your resources\. Like any IAM role, the role has two policies, a permission policy and a trust policy\. The role's trust policy specifies who can assume the role\. In our sample scenario, the policy specifies the AWS account number of Example Corp as the `Principal`\. This allows identities from that account to assume the role\. In addition, you add a `[Condition](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements.html#Condition)` element to the trust policy\. This `Condition` tests the `ExternalId` context key to ensure that it matches the unique customer ID from Example Corp\. For example:

   ```
       "Principal": {"AWS": "Example Corp's AWS account ID"},
       "Condition": {"StringEquals": {"sts:ExternalId": "Unique ID Assigned by Example Corp"}}
   ```

1. The permission policy for the role specifies what the role allows someone to do\. For example, you could specify that the role allows someone to manage only your Amazon EC2 and Amazon RDS resources but not your IAM users or groups\. In our sample scenario, you use the permission policy to give Example Corp read\-only access to all of the resources in your account\.

1. After you create the role, you provide the Amazon Resource Name \(ARN\) of the role to Example Corp\.

1. When Example Corp needs to access your AWS resources, someone from the company calls the AWS `sts:AssumeRole` API\. The call includes the ARN of the role to assume and the ExternalId parameter that corresponds to their customer ID\.

If the request comes from someone using Example Corp's AWS account, and if the role ARN and the external ID are correct, the request succeeds\. It then provides temporary security credentials that Example Corp can use to access the AWS resources that your role allows\.

In other words, when a role policy includes an external ID, anyone who wants to assume the role must be a principal in the role and must include the correct external ID\.

## Why use an external ID?<a name="external-id-purpose"></a>

In abstract terms, the external ID allows the user that is assuming the role to assert the circumstances in which they are operating\. It also provides a way for the account owner to permit the role to be assumed only under specific circumstances\. The primary function of the external ID is to address and prevent [The confused deputy problem](confused-deputy.md)\.

## When should I use an external ID?<a name="external-id-use"></a>

Use an external ID in the following situations:
+ You are an AWS account owner and you have configured a role for a third party that accesses other AWS accounts in addition to yours\. You should ask the third party for an external ID that it includes when it assumes your role\. Then you check for that external ID in your role's trust policy\. Doing so ensures that the external party can assume your role only when it is acting on your behalf\.
+ You are in the position of assuming roles on behalf of different customers like Example Corp in our previous scenario\. You should assign a unique external ID to each customer and instruct them to add the external ID to their role's trust policy\. You must then ensure that you always include the correct external ID in your requests to assume roles\.

  You probably already have a unique identifier for each of your customers, and this unique ID is sufficient for use as an external ID\. The external ID is not a special value that you need to create explicitly, or track separately, just for this purpose\. 

  You should always specify the external ID in your `AssumeRole` API calls\. In addition when a customer gives you a role ARN, test whether you can assume the role both with and without the correct external ID\. If you can assume the role without the correct external ID, don't store the customer's role ARN in your system\. Wait until your customer has updated the role trust policy to require the correct external ID\. In this way you help your customers to do the right thing, which helps to keep both of you protected against the confused deputy problem\.